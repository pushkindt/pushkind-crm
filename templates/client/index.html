{% extends 'base.html' %}

{% block content %}
{% include 'components/navigation.html' %}

<div class="container">
    <div class="row my-2">
        <div class="col">
            <div class="row">
                <div class="col-sm-4">
                    <span class="fw-bold">
                        {{client.name}}
                    </span>
                </div>
                <div class="col-sm">
                    <span class="fw-bold">Менеджеры:</span>
                    {% if managers %}
                        {% for manager in managers %}
                            {% include 'components/user_popover.html' %}
                        {% endfor %}
                    {% else %}
                        —
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col text-end">
            {% include 'client/actions.html' %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-5 my-1">
            {% include 'client/client_card.html' %}
        </div>
        <div class="col-md my-1">
            {% include 'client/client_events.html' %}
        </div>
    </div>
</div>
{% include 'client/save_client_modal.html' %}
{% include 'client/attachment_modal.html' %}

<datalist id="available-custom-fields">
    {% for field in available_fields %}
        <option value="{{field}}"></option>
    {% endfor %}
</datalist>

{% endblock %}

{% block scripts %}
<script>
    function removeCustomField(button) {
        const row = button.closest("div.row");
        row.remove();
    }
    function addCustomField(button) {
        const container = document.getElementById("custom-fields");

        const row = document.createElement("div");
        row.classList.add("row");
        row.classList.add("mb-3");
        container.appendChild(row);

        let col = document.createElement("div");
        col.classList.add("col");
        row.appendChild(col);
        let input = document.createElement("input");
        input.classList.add("form-control");
        input.name = "field";
        input.type = "text";
        input.setAttribute('list', "available-custom-fields");
        input.placeholder = "Поле";
        input.required = true;
        col.appendChild(input);

        col = document.createElement("div");
        col.classList.add("col");
        row.appendChild(col);
        input = document.createElement("input");
        input.classList.add("form-control");
        input.name = "value";
        input.type = "text";
        input.placeholder = "Значение";
        input.required = true;
        col.appendChild(input);

        col = document.createElement("div");
        col.classList.add("col-auto");
        row.appendChild(col);
        const btn = document.createElement("a");
        btn.classList.add("btn");
        btn.classList.add("btn-danger");
        btn.classList.add("btn-sm");
        btn.href = "#";
        btn.onclick = function () {
            removeCustomField(btn);
        };
        col.appendChild(btn);
        const icon = document.createElement("i");
        icon.classList.add("bi");
        icon.classList.add("bi-slash-circle");
        btn.appendChild(icon);
    }
    function toggleSubjectInputVisibility(select) {
        const subjectInput = document.getElementById("event-form-subject");
        if (!subjectInput || !select) {
            return;
        }

        subjectInput.type = select.value === "Email" ? "text" : "hidden";
    }

    document.addEventListener("DOMContentLoaded", function () {
        const eventTypeSelect = document.getElementById("event-form-event-type");
        if (!eventTypeSelect) {
            return;
        }

        toggleSubjectInputVisibility(eventTypeSelect);
        eventTypeSelect.addEventListener("change", function () {
            toggleSubjectInputVisibility(eventTypeSelect);
        });
    });
</script>
{% endblock %}